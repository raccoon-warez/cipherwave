System.register(["./chunk-legacy-CnmjiQTl.js","./chunk-legacy-DcY-LF2r.js","./chunk-legacy-DzyBHhKg.js","./chunk-legacy-C3sAr6jE.js","./chunk-legacy-_OE_0di3.js"],function(e,n){"use strict";var a,i,t,o,r;return{setters:[e=>{a=e._},e=>{i=e.S,t=e.C,o=e.M,r=e.U},null,null,null],execute:function(){class e{constructor(){this.securityManager=null,this.messageManager=null,this.connectionManager=null,this.uiManager=null,this.fileManager=null,this.voiceManager=null,this.performanceMonitor=null,this.isInitialized=!1,this.currentRoom=null,this.isConnected=!1,this.init()}async init(){console.log("üöÄ Initializing CipherWave...");try{await this.initializeCoreManagers(),await this.initializeUI(),this.setupEventListeners(),this.isInitialized=!0,console.log("‚úÖ CipherWave initialized successfully"),this.preloadCriticalChunks()}catch(e){console.error("‚ùå Failed to initialize CipherWave:",e),this.handleInitializationError(e)}}async initializeCoreManagers(){this.securityManager=new i,await this.securityManager.initialize(),this.connectionManager=new t(this.getWebRTCConfig()),this.messageManager=new o(this.securityManager),this.uiManager=new r}async initializeUI(){await this.uiManager.initialize(),this.uiManager.on("connect",(e,n)=>this.connect(e,n)),this.uiManager.on("disconnect",()=>this.disconnect()),this.uiManager.on("sendMessage",e=>this.sendMessage(e)),this.uiManager.on("loadFileManager",()=>this.loadFileManager()),this.uiManager.on("loadVoiceManager",()=>this.loadVoiceManager())}setupEventListeners(){this.connectionManager.on("connected",()=>{this.isConnected=!0,this.uiManager.updateConnectionStatus("connected")}),this.connectionManager.on("disconnected",()=>{this.isConnected=!1,this.uiManager.updateConnectionStatus("disconnected")}),this.connectionManager.on("dataReceived",e=>{this.handleIncomingData(e)}),this.messageManager.on("messageDecrypted",e=>{this.uiManager.displayMessage(e)}),this.connectionManager.on("error",e=>{console.error("Connection error:",e),this.uiManager.showError("Connection error: "+e.message)})}async loadFileManager(){if(!this.fileManager){console.log("üìÅ Loading file manager...");try{const{FileManager:e}=await a(async()=>{const{FileManager:e}=await n.import("./chunk-legacy-C_8oj4N8.js").then(e=>e.f);return{FileManager:e}},void 0);this.fileManager=new e,await this.fileManager.setup(),console.log("‚úÖ File manager loaded")}catch(e){console.error("‚ùå Failed to load file manager:",e),this.uiManager.showError("Failed to load file sharing features")}}return this.fileManager}async loadVoiceManager(){if(!this.voiceManager){console.log("üé§ Loading voice manager...");try{const{VoiceManager:e}=await a(async()=>{const{VoiceManager:e}=await n.import("./chunk-legacy-C_8oj4N8.js").then(e=>e.v);return{VoiceManager:e}},void 0);this.voiceManager=new e,await this.voiceManager.init(),console.log("‚úÖ Voice manager loaded")}catch(e){console.error("‚ùå Failed to load voice manager:",e),this.uiManager.showError("Failed to load voice features")}}return this.voiceManager}async loadMobileFeatures(){if(this.isMobile()){console.log("üì± Loading mobile features...");try{const{MobileManager:e}=await a(async()=>{const{MobileManager:e}=await n.import("./chunk-legacy-CnmjiQTl.js").then(e=>e.m);return{MobileManager:e}},void 0);this.mobileManager=new e,await this.mobileManager.initialize(),console.log("‚úÖ Mobile features loaded")}catch(e){console.error("‚ùå Failed to load mobile features:",e)}}}async preloadCriticalChunks(){console.log("üöÄ Critical chunks will be loaded on demand")}async connect(e,n="chacha20-poly1305"){if(!this.isInitialized)throw new Error("CipherWave not initialized");try{this.currentRoom=e,this.uiManager.updateConnectionStatus("connecting"),await this.securityManager.setCipher(n),await this.connectionManager.connect(e)}catch(a){throw console.error("Connection failed:",a),this.uiManager.updateConnectionStatus("error"),a}}async disconnect(){this.connectionManager&&await this.connectionManager.disconnect(),this.currentRoom=null,this.isConnected=!1}async sendMessage(e){if(!this.isConnected)throw new Error("Not connected to a room");try{const n=await this.messageManager.encryptMessage(e);await this.connectionManager.sendData(n),this.uiManager.displayMessage({text:e,sender:"self",timestamp:Date.now(),encrypted:!0})}catch(n){throw console.error("Failed to send message:",n),this.uiManager.showError("Failed to send message"),n}}async handleIncomingData(e){try{const n=await this.messageManager.decryptMessage(e);this.uiManager.displayMessage({...n,sender:"peer",timestamp:Date.now()})}catch(n){console.error("Failed to decrypt message:",n)}}getWebRTCConfig(){return{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"}],iceCandidatePoolSize:10,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}}isMobile(){return/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}handleInitializationError(e){document.body.innerHTML=`\n            <div style="color: #ff6b6b; text-align: center; padding: 50px; font-family: monospace;">\n                <h2>CipherWave Initialization Failed</h2>\n                <p>Error: ${e.message}</p>\n                <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #0088cc; color: white; border: none; border-radius: 5px; cursor: pointer;">\n                    Retry\n                </button>\n            </div>\n        `}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.cipherWave=new e}):window.cipherWave=new e}}});
//# sourceMappingURL=main-legacy-D5cvuzhE.js.map
