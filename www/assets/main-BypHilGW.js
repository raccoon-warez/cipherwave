function e(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}import{_ as n}from"./chunk-CGihlwpU.js";import{S as i,C as a,M as t,U as o}from"./chunk-C8-IYZm0.js";import"./chunk-CPu859Ob.js";import"./chunk-C5CM1_3S.js";import"./chunk-DeIA6xm2.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&n(e)}).observe(document,{childList:!0,subtree:!0})}function n(e){if(e.ep)return;e.ep=!0;const n=function(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?n.credentials="include":"anonymous"===e.crossOrigin?n.credentials="omit":n.credentials="same-origin",n}(e);fetch(e.href,n)}}();class r{constructor(){this.securityManager=null,this.messageManager=null,this.connectionManager=null,this.uiManager=null,this.fileManager=null,this.voiceManager=null,this.performanceMonitor=null,this.isInitialized=!1,this.currentRoom=null,this.isConnected=!1,this.init()}async init(){console.log("üöÄ Initializing CipherWave...");try{await this.initializeCoreManagers(),await this.initializeUI(),this.setupEventListeners(),this.isInitialized=!0,console.log("‚úÖ CipherWave initialized successfully"),this.preloadCriticalChunks()}catch(e){console.error("‚ùå Failed to initialize CipherWave:",e),this.handleInitializationError(e)}}async initializeCoreManagers(){this.securityManager=new i,await this.securityManager.initialize(),this.connectionManager=new a(this.getWebRTCConfig()),this.messageManager=new t(this.securityManager),this.uiManager=new o}async initializeUI(){await this.uiManager.initialize(),this.uiManager.on("connect",(e,n)=>this.connect(e,n)),this.uiManager.on("disconnect",()=>this.disconnect()),this.uiManager.on("sendMessage",e=>this.sendMessage(e)),this.uiManager.on("loadFileManager",()=>this.loadFileManager()),this.uiManager.on("loadVoiceManager",()=>this.loadVoiceManager())}setupEventListeners(){this.connectionManager.on("connected",()=>{this.isConnected=!0,this.uiManager.updateConnectionStatus("connected")}),this.connectionManager.on("disconnected",()=>{this.isConnected=!1,this.uiManager.updateConnectionStatus("disconnected")}),this.connectionManager.on("dataReceived",e=>{this.handleIncomingData(e)}),this.messageManager.on("messageDecrypted",e=>{this.uiManager.displayMessage(e)}),this.connectionManager.on("error",e=>{console.error("Connection error:",e),this.uiManager.showError("Connection error: "+e.message)})}async loadFileManager(){if(!this.fileManager){console.log("üìÅ Loading file manager...");try{const{FileManager:e}=await n(async()=>{const{FileManager:e}=await import("./chunk-BHpPQUns.js").then(e=>e.f);return{FileManager:e}},[]);this.fileManager=new e,await this.fileManager.setup(),console.log("‚úÖ File manager loaded")}catch(e){console.error("‚ùå Failed to load file manager:",e),this.uiManager.showError("Failed to load file sharing features")}}return this.fileManager}async loadVoiceManager(){if(!this.voiceManager){console.log("üé§ Loading voice manager...");try{const{VoiceManager:e}=await n(async()=>{const{VoiceManager:e}=await import("./chunk-BHpPQUns.js").then(e=>e.v);return{VoiceManager:e}},[]);this.voiceManager=new e,await this.voiceManager.init(),console.log("‚úÖ Voice manager loaded")}catch(e){console.error("‚ùå Failed to load voice manager:",e),this.uiManager.showError("Failed to load voice features")}}return this.voiceManager}async loadMobileFeatures(){if(this.isMobile()){console.log("üì± Loading mobile features...");try{const{MobileManager:e}=await n(async()=>{const{MobileManager:e}=await import("./chunk-CGihlwpU.js").then(e=>e.m);return{MobileManager:e}},[]);this.mobileManager=new e,await this.mobileManager.initialize(),console.log("‚úÖ Mobile features loaded")}catch(e){console.error("‚ùå Failed to load mobile features:",e)}}}async preloadCriticalChunks(){console.log("üöÄ Critical chunks will be loaded on demand")}async connect(e,n="chacha20-poly1305"){if(!this.isInitialized)throw new Error("CipherWave not initialized");try{this.currentRoom=e,this.uiManager.updateConnectionStatus("connecting"),await this.securityManager.setCipher(n),await this.connectionManager.connect(e)}catch(i){throw console.error("Connection failed:",i),this.uiManager.updateConnectionStatus("error"),i}}async disconnect(){this.connectionManager&&await this.connectionManager.disconnect(),this.currentRoom=null,this.isConnected=!1}async sendMessage(e){if(!this.isConnected)throw new Error("Not connected to a room");try{const n=await this.messageManager.encryptMessage(e);await this.connectionManager.sendData(n),this.uiManager.displayMessage({text:e,sender:"self",timestamp:Date.now(),encrypted:!0})}catch(n){throw console.error("Failed to send message:",n),this.uiManager.showError("Failed to send message"),n}}async handleIncomingData(e){try{const n=await this.messageManager.decryptMessage(e);this.uiManager.displayMessage({...n,sender:"peer",timestamp:Date.now()})}catch(n){console.error("Failed to decrypt message:",n)}}getWebRTCConfig(){return{iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"turn:openrelay.metered.ca:80",username:"openrelayproject",credential:"openrelayproject"}],iceCandidatePoolSize:10,iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}}isMobile(){return/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}handleInitializationError(e){document.body.innerHTML='\n            <div style="color: #ff6b6b; text-align: center; padding: 50px; font-family: monospace;">\n                <h2>CipherWave Initialization Failed</h2>\n                <p>Error: '.concat(e.message,'</p>\n                <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #0088cc; color: white; border: none; border-radius: 5px; cursor: pointer;">\n                    Retry\n                </button>\n            </div>\n        ')}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.cipherWave=new r}):window.cipherWave=new r;export{e as __vite_legacy_guard};
//# sourceMappingURL=main-BypHilGW.js.map
