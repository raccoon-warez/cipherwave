const e=Object.freeze(Object.defineProperty({__proto__:null,FileManager:class{constructor(){this.maxFileSize=52428800,this.allowedTypes={images:["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"],videos:["video/mp4","video/webm","video/ogg","video/mov","video/avi"],audio:["audio/mp3","audio/wav","audio/ogg","audio/webm","audio/m4a"],documents:["application/pdf","text/plain","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],archives:["application/zip","application/x-rar-compressed","application/x-7z-compressed"]},this.uploadQueue=[],this.activeUploads=new Map,this.compressionSettings={image:{quality:.8,maxWidth:1920,maxHeight:1080},video:{quality:.7,maxWidth:1280,maxHeight:720}},this.chunkSize=65536,this.thumbnailSize={width:300,height:200},console.log("üìÅ File manager loaded")}async setup(){console.log("üìÅ Setting up file sharing system..."),this.setupDragAndDrop(),this.setupFileInput(),this.setupClipboardPaste(),this.createFileUploadUI()}setupDragAndDrop(){const e=document.body;e.addEventListener("dragover",t=>{t.preventDefault(),t.stopPropagation(),e.classList.add("drag-over")}),e.addEventListener("dragleave",t=>{t.preventDefault(),t.stopPropagation(),e.contains(t.relatedTarget)||e.classList.remove("drag-over")}),e.addEventListener("drop",t=>{t.preventDefault(),t.stopPropagation(),e.classList.remove("drag-over");const i=Array.from(t.dataTransfer.files);this.handleFileSelection(i)})}setupFileInput(){const e=document.createElement("input");e.type="file",e.multiple=!0,e.style.display="none",e.id="fileInput",e.addEventListener("change",e=>{const t=Array.from(e.target.files);this.handleFileSelection(t)}),document.body.appendChild(e),this.createFileShareButton()}setupClipboardPaste(){document.addEventListener("paste",e=>{const t=Array.from(e.clipboardData.items).filter(e=>"file"===e.kind).map(e=>e.getAsFile());t.length>0&&(e.preventDefault(),this.handleFileSelection(t))})}createFileShareButton(){const e=document.getElementById("chat-panel");if(!e||document.getElementById("fileShareBtn"))return;const t=e.querySelector(".message-input-group");if(!t)return;const i=document.createElement("button");i.id="fileShareBtn",i.className="btn btn-secondary",i.innerHTML='<i class="fas fa-paperclip"></i>',i.title="Share file",i.addEventListener("click",()=>{document.getElementById("fileInput").click()}),t.insertBefore(i,t.lastElementChild)}createFileUploadUI(){if(!document.getElementById("fileManagerStyles")){const e=document.createElement("style");e.id="fileManagerStyles",e.textContent='\n                .drag-over::after {\n                    content: "Drop files to send";\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    width: 100%;\n                    height: 100%;\n                    background: rgba(0, 136, 204, 0.8);\n                    color: white;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    font-size: 2rem;\n                    z-index: 10000;\n                    pointer-events: none;\n                }\n                \n                .file-upload-progress {\n                    background: #1a1f29;\n                    border: 1px solid #2a3441;\n                    border-radius: 8px;\n                    padding: 15px;\n                    margin: 10px 0;\n                    max-width: 400px;\n                }\n                \n                .file-upload-info {\n                    display: flex;\n                    align-items: center;\n                    margin-bottom: 10px;\n                }\n                \n                .file-upload-icon {\n                    font-size: 2rem;\n                    margin-right: 15px;\n                    color: #0088cc;\n                }\n                \n                .file-upload-details h4 {\n                    margin: 0 0 5px 0;\n                    color: #ffffff;\n                }\n                \n                .file-upload-details p {\n                    margin: 0;\n                    color: #8899a6;\n                    font-size: 0.9rem;\n                }\n                \n                .file-upload-progress-bar {\n                    width: 100%;\n                    height: 6px;\n                    background: #2a3441;\n                    border-radius: 3px;\n                    overflow: hidden;\n                }\n                \n                .file-upload-progress-fill {\n                    height: 100%;\n                    background: #0088cc;\n                    transition: width 0.3s ease;\n                }\n                \n                .file-preview {\n                    max-width: 200px;\n                    max-height: 200px;\n                    border-radius: 8px;\n                    margin: 10px 0;\n                }\n            ',document.head.appendChild(e)}}async handleFileSelection(e){console.log("üìÅ Processing ".concat(e.length," file(s)"));for(const t of e)this.validateFile(t)&&await this.processFile(t)}validateFile(e){if(e.size>this.maxFileSize)return this.showError('File "'.concat(e.name,'" is too large (max ').concat(this.maxFileSize/1024/1024,"MB)")),!1;return!!Object.values(this.allowedTypes).flat().some(t=>e.type===t||e.type.startsWith(t.split("/")[0]))||(this.showError('File type "'.concat(e.type,'" is not allowed')),!1)}async processFile(e){const t=this.generateFileId(),i={id:t,file:e,status:"processing",progress:0,chunks:[],thumbnail:null};this.activeUploads.set(t,i);try{this.showUploadProgress(i),(e.type.startsWith("image/")||e.type.startsWith("video/"))&&(i.thumbnail=await this.generateThumbnail(e));const t=await this.compressFile(e);i.chunks=await this.splitFileIntoChunks(t),i.status="ready",await this.sendFileMetadata(i),await this.sendFileChunks(i),i.status="completed",this.updateUploadProgress(i),console.log('‚úÖ File "'.concat(e.name,'" sent successfully'))}catch(n){console.error('‚ùå Failed to process file "'.concat(e.name,'":'),n),i.status="error",i.error=n.message,this.updateUploadProgress(i)}}async generateThumbnail(e){return new Promise(t=>{if(e.type.startsWith("image/")){const i=new Image;i.onload=()=>{const e=document.createElement("canvas"),n=e.getContext("2d"),{width:o,height:a}=this.calculateThumbnailSize(i.width,i.height);e.width=o,e.height=a,n.drawImage(i,0,0,o,a),t(e.toDataURL("image/jpeg",.8))},i.src=URL.createObjectURL(e)}else t(null)})}calculateThumbnailSize(e,t){const{width:i,height:n}=this.thumbnailSize,o=Math.min(i/e,n/t);return{width:Math.round(e*o),height:Math.round(t*o)}}async compressFile(e){return e}async splitFileIntoChunks(e){const t=[],i=Math.ceil(e.size/this.chunkSize);for(let n=0;n<i;n++){const i=n*this.chunkSize,o=Math.min(i+this.chunkSize,e.size),a=e.slice(i,o);t.push({index:n,data:await this.fileToBase64(a),size:a.size})}return t}async fileToBase64(e){return new Promise((t,i)=>{const n=new FileReader;n.onload=()=>t(n.result.split(",")[1]),n.onerror=i,n.readAsDataURL(e)})}async sendFileMetadata(e){const t={type:"file_metadata",fileId:e.id,name:e.file.name,size:e.file.size,type:e.file.type,chunks:e.chunks.length,thumbnail:e.thumbnail,timestamp:Date.now()};window.cipherWave&&window.cipherWave.connectionManager&&await window.cipherWave.connectionManager.sendData(t)}async sendFileChunks(e){for(let t=0;t<e.chunks.length;t++){const i=e.chunks[t],n={type:"file_chunk",fileId:e.id,chunkIndex:i.index,data:i.data,isLast:t===e.chunks.length-1};window.cipherWave&&window.cipherWave.connectionManager&&await window.cipherWave.connectionManager.sendData(n),e.progress=(t+1)/e.chunks.length*100,this.updateUploadProgress(e),await new Promise(e=>setTimeout(e,10))}}showUploadProgress(e){const t=document.getElementById("messages");if(!t)return;const i=document.createElement("div");i.className="file-upload-progress",i.id="upload-".concat(e.id),i.innerHTML='\n            <div class="file-upload-info">\n                <div class="file-upload-icon">\n                    <i class="fas fa-file"></i>\n                </div>\n                <div class="file-upload-details">\n                    <h4>'.concat(e.file.name,"</h4>\n                    <p>").concat(this.formatFileSize(e.file.size)," ‚Ä¢ ").concat(e.file.type,'</p>\n                </div>\n            </div>\n            <div class="file-upload-progress-bar">\n                <div class="file-upload-progress-fill" style="width: 0%"></div>\n            </div>\n        '),t.appendChild(i),t.scrollTop=t.scrollHeight}updateUploadProgress(e){const t=document.getElementById("upload-".concat(e.id));if(!t)return;const i=t.querySelector(".file-upload-progress-fill");if(i&&(i.style.width="".concat(e.progress,"%")),"completed"===e.status)setTimeout(()=>{t.parentElement&&t.remove()},2e3);else if("error"===e.status){t.style.borderColor="#ff6b6b";const i=t.querySelector(".file-upload-details p");i&&(i.textContent="Error: ".concat(e.error),i.style.color="#ff6b6b")}}generateFileId(){return"file_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}showError(e){window.cipherWave&&window.cipherWave.uiManager?window.cipherWave.uiManager.showError(e):console.error(e)}destroy(){this.activeUploads.clear(),this.uploadQueue=[];const e=document.getElementById("fileInput");e&&e.remove();const t=document.getElementById("fileShareBtn");t&&t.remove();const i=document.getElementById("fileManagerStyles");i&&i.remove(),console.log("üóëÔ∏è File manager destroyed")}}},Symbol.toStringTag,{value:"Module"}));window.voiceManager=null;const t=Object.freeze(Object.defineProperty({__proto__:null,VoiceManager:class{constructor(){this.isRecording=!1,this.mediaRecorder=null,this.audioContext=null,this.analyser=null,this.microphone=null,this.recordedChunks=[],this.recordingStartTime=null,this.recordingDuration=0,this.maxRecordingTime=3e5,this.recordingTimer=null,this.waveformCanvas=null,this.waveformContext=null,this.animationFrame=null,this.supportedMimeTypes=["audio/webm","audio/mp4","audio/wav"],this.selectedMimeType=null,this.voiceMessages=new Map,this.voiceButton=null,this.recordingIndicator=null,this.waveformContainer=null,this.currentlyPlaying=null,this.isPlaying=!1,this.microphoneAccess=!1,this.compressionOptions={mimeType:"audio/webm;codecs=opus",audioBitsPerSecond:128e3},console.log("üé§ Voice manager loaded")}async init(){console.log("üé§ Initializing voice messaging system...");try{await this.requestMicrophoneAccess(),this.detectSupportedMimeType(),this.createVoiceUI(),console.log("‚úÖ Voice manager initialized successfully")}catch(e){throw console.error("‚ùå Failed to initialize voice manager:",e),e}}async requestMicrophoneAccess(){try{const e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});this.microphoneAccess=!0,e.getTracks().forEach(e=>e.stop()),console.log("üé§ Microphone access granted")}catch(e){throw console.error("Microphone access denied:",e),new Error("Microphone access is required for voice messages")}}detectSupportedMimeType(){for(const e of this.supportedMimeTypes)if(MediaRecorder.isTypeSupported(e)){this.selectedMimeType=e,console.log("üé§ Using audio format: ".concat(e));break}if(!this.selectedMimeType)throw new Error("No supported audio format found")}createVoiceUI(){const e=document.getElementById("chat-panel");if(!e||document.getElementById("voiceBtn"))return;const t=e.querySelector(".message-input-group");t&&(this.voiceButton=document.createElement("button"),this.voiceButton.id="voiceBtn",this.voiceButton.className="btn btn-secondary voice-btn",this.voiceButton.innerHTML='<i class="fas fa-microphone"></i>',this.voiceButton.title="Record voice message",this.voiceButton.addEventListener("mousedown",e=>{e.preventDefault(),this.startRecording()}),this.voiceButton.addEventListener("mouseup",e=>{e.preventDefault(),this.stopRecording()}),this.voiceButton.addEventListener("mouseleave",e=>{this.isRecording&&this.stopRecording()}),this.voiceButton.addEventListener("touchstart",e=>{e.preventDefault(),this.startRecording()}),this.voiceButton.addEventListener("touchend",e=>{e.preventDefault(),this.stopRecording()}),t.insertBefore(this.voiceButton,t.lastElementChild),this.addVoiceStyles())}addVoiceStyles(){if(document.getElementById("voiceManagerStyles"))return;const e=document.createElement("style");e.id="voiceManagerStyles",e.textContent="\n            .voice-btn {\n                position: relative;\n                transition: all 0.3s ease;\n            }\n            \n            .voice-btn.recording {\n                background: #ff4757 !important;\n                animation: pulse 1s infinite;\n            }\n            \n            @keyframes pulse {\n                0% { transform: scale(1); }\n                50% { transform: scale(1.1); }\n                100% { transform: scale(1); }\n            }\n            \n            .voice-recording-overlay {\n                position: fixed;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background: rgba(0, 0, 0, 0.8);\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                z-index: 10000;\n                flex-direction: column;\n            }\n            \n            .voice-recording-content {\n                background: #1a1f29;\n                border-radius: 20px;\n                padding: 40px;\n                text-align: center;\n                border: 2px solid #ff4757;\n            }\n            \n            .voice-recording-icon {\n                font-size: 4rem;\n                color: #ff4757;\n                margin-bottom: 20px;\n                animation: pulse 1s infinite;\n            }\n            \n            .voice-recording-time {\n                font-size: 2rem;\n                color: #ffffff;\n                margin-bottom: 10px;\n                font-family: monospace;\n            }\n            \n            .voice-recording-instruction {\n                color: #8899a6;\n                font-size: 1.1rem;\n            }\n            \n            .voice-waveform {\n                width: 300px;\n                height: 60px;\n                margin: 20px auto;\n                background: #2a3441;\n                border-radius: 30px;\n            }\n            \n            .voice-message {\n                display: flex;\n                align-items: center;\n                background: #2a3441;\n                border-radius: 20px;\n                padding: 10px 15px;\n                margin: 5px 0;\n                max-width: 250px;\n            }\n            \n            .voice-message-play {\n                background: #0088cc;\n                border: none;\n                border-radius: 50%;\n                width: 40px;\n                height: 40px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                color: white;\n                cursor: pointer;\n                margin-right: 10px;\n            }\n            \n            .voice-message-duration {\n                color: #8899a6;\n                font-size: 0.9rem;\n                font-family: monospace;\n            }\n            \n            .voice-message-waveform {\n                flex: 1;\n                height: 30px;\n                margin: 0 10px;\n                background: #1a1f29;\n                border-radius: 15px;\n                position: relative;\n            }\n        ",document.head.appendChild(e)}async startRecording(){if(!this.isRecording&&this.microphoneAccess){console.log("üé§ Starting voice recording...");try{const e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.analyser=this.audioContext.createAnalyser(),this.microphone=this.audioContext.createMediaStreamSource(e),this.microphone.connect(this.analyser),this.analyser.fftSize=256,this.mediaRecorder=new MediaRecorder(e,{mimeType:this.selectedMimeType,audioBitsPerSecond:this.compressionOptions.audioBitsPerSecond}),this.recordedChunks=[],this.mediaRecorder.ondataavailable=e=>{e.data.size>0&&this.recordedChunks.push(e.data)},this.mediaRecorder.onstop=()=>{this.processRecordedAudio()},this.mediaRecorder.start(),this.isRecording=!0,this.recordingStartTime=Date.now(),this.showRecordingUI(),this.voiceButton.classList.add("recording"),this.startWaveformAnimation(),this.startRecordingTimer()}catch(e){console.error("Failed to start recording:",e),this.showError("Failed to start voice recording")}}}stopRecording(){this.isRecording&&(console.log("üé§ Stopping voice recording..."),this.isRecording=!1,this.recordingDuration=Date.now()-this.recordingStartTime,this.mediaRecorder&&"recording"===this.mediaRecorder.state&&this.mediaRecorder.stop(),this.microphone&&this.microphone.stream&&this.microphone.stream.getTracks().forEach(e=>e.stop()),this.audioContext&&(this.audioContext.close(),this.audioContext=null),this.hideRecordingUI(),this.voiceButton.classList.remove("recording"),this.stopWaveformAnimation(),this.stopRecordingTimer())}showRecordingUI(){if(document.getElementById("voiceRecordingOverlay"))return;const e=document.createElement("div");e.id="voiceRecordingOverlay",e.className="voice-recording-overlay",e.innerHTML='\n            <div class="voice-recording-content">\n                <div class="voice-recording-icon">\n                    <i class="fas fa-microphone"></i>\n                </div>\n                <div class="voice-recording-time" id="recordingTime">0:00</div>\n                <canvas class="voice-waveform" id="recordingWaveform" width="300" height="60"></canvas>\n                <div class="voice-recording-instruction">Hold to record, release to send</div>\n            </div>\n        ',document.body.appendChild(e),this.waveformCanvas=document.getElementById("recordingWaveform"),this.waveformContext=this.waveformCanvas.getContext("2d")}hideRecordingUI(){const e=document.getElementById("voiceRecordingOverlay");e&&e.remove(),this.waveformCanvas=null,this.waveformContext=null}startWaveformAnimation(){if(!this.analyser||!this.waveformContext)return;const e=this.analyser.frequencyBinCount,t=new Uint8Array(e),i=()=>{if(!this.isRecording)return;this.animationFrame=requestAnimationFrame(i),this.analyser.getByteFrequencyData(t),this.waveformContext.fillStyle="#2a3441",this.waveformContext.fillRect(0,0,this.waveformCanvas.width,this.waveformCanvas.height);const n=this.waveformCanvas.width/e*2.5;let o,a=0;for(let i=0;i<e;i++)o=t[i]/255*this.waveformCanvas.height*.8,this.waveformContext.fillStyle="rgb(0, 136, 204)",this.waveformContext.fillRect(a,this.waveformCanvas.height-o,n,o),a+=n+1};i()}stopWaveformAnimation(){this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=null)}startRecordingTimer(){this.recordingTimer=setInterval(()=>{const e=Date.now()-this.recordingStartTime,t=Math.floor(e/6e4),i=Math.floor(e%6e4/1e3),n=document.getElementById("recordingTime");n&&(n.textContent="".concat(t,":").concat(i.toString().padStart(2,"0"))),e>=this.maxRecordingTime&&this.stopRecording()},100)}stopRecordingTimer(){this.recordingTimer&&(clearInterval(this.recordingTimer),this.recordingTimer=null)}async processRecordedAudio(){if(0!==this.recordedChunks.length)if(this.recordingDuration<500)console.warn("Recording too short, discarding");else{console.log("üé§ Processing ".concat(this.recordingDuration,"ms of audio..."));try{const e=new Blob(this.recordedChunks,{type:this.selectedMimeType}),t=await this.blobToBase64(e),i={type:"voice_message",id:this.generateVoiceMessageId(),data:t,duration:this.recordingDuration,mimeType:this.selectedMimeType,timestamp:Date.now()};await this.sendVoiceMessage(i),this.displayVoiceMessage(i,"self")}catch(e){console.error("Failed to process recorded audio:",e),this.showError("Failed to process voice message")}}else console.warn("No audio data recorded")}async blobToBase64(e){return new Promise((t,i)=>{const n=new FileReader;n.onload=()=>t(n.result.split(",")[1]),n.onerror=i,n.readAsDataURL(e)})}async sendVoiceMessage(e){window.cipherWave&&window.cipherWave.connectionManager&&(await window.cipherWave.connectionManager.sendData(e),console.log("üé§ Voice message sent"))}displayVoiceMessage(e,t){const i=document.getElementById("messages");if(!i)return;const n=document.createElement("div");n.className="message ".concat("self"===t?"message-sent":"message-received");const o=this.formatDuration(e.duration),a=new Date(e.timestamp).toLocaleTimeString();n.innerHTML='\n            <div class="voice-message">\n                <button class="voice-message-play" onclick="window.voiceManager.playVoiceMessage(\''.concat(e.id,'\')">\n                    <i class="fas fa-play"></i>\n                </button>\n                <div class="voice-message-waveform"></div>\n                <div class="voice-message-duration">').concat(o,'</div>\n            </div>\n            <div class="message-time">').concat(a,"</div>\n        "),i.appendChild(n),i.scrollTop=i.scrollHeight,this.voiceMessages.set(e.id,e)}async playVoiceMessage(e){const t=this.voiceMessages.get(e);if(t)try{this.currentlyPlaying&&(this.currentlyPlaying.pause(),this.currentlyPlaying=null);const i=atob(t.data),n=new Uint8Array(i.length);for(let e=0;e<i.length;e++)n[e]=i.charCodeAt(e);const o=new Blob([n],{type:t.mimeType}),a=URL.createObjectURL(o),s=new Audio(a);this.currentlyPlaying=s,this.isPlaying=!0;const r=document.querySelector("button[onclick=\"window.voiceManager.playVoiceMessage('".concat(e,"')\"]"));r&&(r.innerHTML='<i class="fas fa-pause"></i>'),s.onended=()=>{this.isPlaying=!1,this.currentlyPlaying=null,URL.revokeObjectURL(a),r&&(r.innerHTML='<i class="fas fa-play"></i>')},await s.play()}catch(i){console.error("Failed to play voice message:",i),this.showError("Failed to play voice message")}else console.error("Voice message not found:",e)}generateVoiceMessageId(){return"voice_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}formatDuration(e){const t=Math.floor(e/1e3),i=Math.floor(t/60),n=t%60;return"".concat(i,":").concat(n.toString().padStart(2,"0"))}showError(e){window.cipherWave&&window.cipherWave.uiManager?window.cipherWave.uiManager.showError(e):console.error(e)}destroy(){this.isRecording&&this.stopRecording(),this.currentlyPlaying&&(this.currentlyPlaying.pause(),this.currentlyPlaying=null),this.voiceButton&&this.voiceButton.remove(),this.hideRecordingUI();const e=document.getElementById("voiceManagerStyles");e&&e.remove(),this.voiceMessages.clear(),console.log("üóëÔ∏è Voice manager destroyed")}}},Symbol.toStringTag,{value:"Module"}));export{e as f,t as v};
//# sourceMappingURL=chunk-BHpPQUns.js.map
